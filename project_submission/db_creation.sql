BEGIN EXECUTE IMMEDIATE 'DROP TABLE Mechanic_Swap_Request'; EXCEPTION WHEN OTHERS THEN NULL; END;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE USER_TABLE'; EXCEPTION WHEN OTHERS THEN NULL;  END;
BEGIN EXECUTE IMMEDIATE 'DROP TRIGGER CS_ID'; EXCEPTION WHEN OTHERS THEN NULL;  END;
BEGIN EXECUTE IMMEDIATE 'DROP SEQUENCE seq'; EXCEPTION WHEN OTHERS THEN NULL;  END;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE CALENDER_SLOTS'; EXCEPTION WHEN OTHERS THEN NULL;  END;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE SLOTS'; EXCEPTION WHEN OTHERS THEN NULL;  END;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE INVOICE_SERVICE'; EXCEPTION WHEN OTHERS THEN NULL;  END;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE INVOICE'; EXCEPTION WHEN OTHERS THEN NULL;  END;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE CUSTOMER_HAS_VEHICLE'; EXCEPTION WHEN OTHERS THEN NULL;  END;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE MAINTENANCE_SERVICES'; EXCEPTION WHEN OTHERS THEN NULL;  END;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE REPAIR_SERVICES'; EXCEPTION WHEN OTHERS THEN NULL;  END;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE CAR_PRICING'; EXCEPTION WHEN OTHERS THEN NULL;  END;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE MECHANIC'; EXCEPTION WHEN OTHERS THEN NULL;  END;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE RECEPTIONIST'; EXCEPTION WHEN OTHERS THEN NULL;  END;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE SERVICE_CENTER'; EXCEPTION WHEN OTHERS THEN NULL;  END;
BEGIN EXECUTE IMMEDIATE 'DROP TABLE MANAGER'; EXCEPTION WHEN OTHERS THEN NULL;  END;

CREATE TABLE MANAGER(MANAGER_ID number PRIMARY KEY, Manager_ansal float, name varchar(50), phn_no varchar(15), address varchar(50), email varchar(30))
CREATE TABLE SERVICE_CENTER(SVC_ID number PRIMARY KEY,  address varchar(100), phn_no varchar(15),Saturday_flag smallint DEFAULT 0, MANAGER_ID number DEFAULT NULL, Min_wage number, Max_wage number, mech_hourly_wages float, CONSTRAINT FK_MGR FOREIGN KEY(MANAGER_ID) REFERENCES MANAGER(MANAGER_ID) ON DELETE SET NULL)
CREATE TABLE RECEPTIONIST(RECEPTIONIST_ID number, SVC_ID number PRIMARY KEY, name varchar(50), phn_no varchar(15), address varchar(100), email varchar(30), receptionist_ansal float, CONSTRAINT FK_SVCID_REC FOREIGN KEY(SVC_ID) REFERENCES SERVICE_CENTER(SVC_ID) ON DELETE CASCADE)
CREATE TABLE MECHANIC ( MECHANIC_ID number, SVC_ID number, name varchar(100), phone_no varchar(15), address varchar(100), email varchar(30), mech_comp float, start_date DATE, time_off smallint DEFAULT 0, PRIMARY KEY(MECHANIC_ID,SVC_ID), CONSTRAINT FK_SVCID_MEC FOREIGN KEY (SVC_ID) REFERENCES  SERVICE_CENTER(SVC_ID) ON DELETE CASCADE)
CREATE TABLE CAR_PRICING(SVC_ID number,Model VARCHAR(20),Price_tier number, price float,PRIMARY KEY (SVC_ID,Model,Price_tier),CONSTRAINT FK_SVCID_CAR_PR FOREIGN KEY(SVC_ID) REFERENCES SERVICE_CENTER(SVC_ID) ON DELETE CASCADE) 
CREATE TABLE REPAIR_SERVICES(SERVICE_ID number PRIMARY KEY, repair_category varchar(50), repair_subcategory varchar(50), pricing_tier number, time_hrs number) 
CREATE TABLE MAINTENANCE_SERVICES(SERVICE_ID number, Schedule varchar(3), Service_name varchar(50), Service_type varchar(50), Pricing_tier INT, Time_hrs INT, PRIMARY KEY(SERVICE_ID,Service_name)) 
CREATE TABLE CUSTOMER_HAS_VEHICLE(CID number, Full_name varchar(50), SVC_ID number, VIN varchar(30), car_manf varchar(40), c_mil float, last_schedule varchar(10), year number, PRIMARY KEY( VIN),CONSTRAINT FK_SVCID FOREIGN KEY(SVC_ID) REFERENCES SERVICE_CENTER(SVC_ID) ON DELETE CASCADE) 
CREATE TABLE INVOICE ( INVOICE_ID number PRIMARY KEY, VIN varchar(30), Week INT, Day INT, Start_time_slot INT, End_time_slot INT, MECHANIC_ID number, Total_cost float, Invoice_status VARCHAR(10), CONSTRAINT FK_VIN FOREIGN KEY (VIN)  REFERENCES CUSTOMER_HAS_VEHICLE (VIN) ON DELETE CASCADE )  
CREATE TABLE INVOICE_SERVICE(INVOICE_ID number,SERVICE_ID number, PRIMARY KEY (INVOICE_ID,SERVICE_ID), CONSTRAINT FK_INVID FOREIGN KEY (INVOICE_ID) REFERENCES INVOICE (INVOICE_ID) ON DELETE CASCADE)
CREATE TABLE SLOTS ( SID number PRIMARY KEY,  start_time timestamp, end_time timestamp )  
CREATE TABLE CALENDER_SLOTS (ID number NOT NULL, SVC_ID number, SID number, MECHANIC_ID number, WEEK_ID number, DAY_ID number, INVOICE_ID number, PRIMARY KEY(SID, MECHANIC_ID, ID))
CREATE SEQUENCE seq START WITH 1
CREATE OR REPLACE TRIGGER CS_ID BEFORE INSERT ON CALENDER_SLOTS FOR EACH ROW BEGIN SELECT seq.NEXTVAL INTO :new.id FROM DUAL; END;
CREATE TABLE USER_TABLE (ID VARCHAR(32) PRIMARY KEY, PASSWORD VARCHAR(32) NOT NULL, TYPE VARCHAR(32) NOT NULL)
CREATE TABLE Mechanic_Swap_Request( id NUMBER GENERATED BY DEFAULT AS IDENTITY(START with 1 INCREMENT by 1), SVC_ID number, donor_mid number, receiver_mid number , donor_timeslot_day number CHECK (donor_timeslot_day >= 1 AND donor_timeslot_day <= 6),  donor_timeslot_week number CHECK (donor_timeslot_week IN (1,2,3,4)),  donor_timeslot_begin number CHECK (donor_timeslot_begin >= 1 AND donor_timeslot_begin <= 11),  donor_timeslot_end number CHECK (donor_timeslot_end >= 1 AND donor_timeslot_end <= 11),  receiver_timeslot_day number CHECK (receiver_timeslot_day >= 1 AND receiver_timeslot_day <= 6),  receiver_timeslot_week number CHECK (receiver_timeslot_week IN (1,2,3,4)),  receiver_timeslot_begin number CHECK (receiver_timeslot_begin >= 1 AND receiver_timeslot_begin <= 11),  receiver_timeslot_end number CHECK(receiver_timeslot_end >= 1 AND receiver_timeslot_end <= 11),  state number DEFAULT 0 CHECK (state IN (0, 1, 2)), PRIMARY KEY(id), CONSTRAINT FK_donor_mid FOREIGN KEY (donor_mid,SVC_ID) REFERENCES MECHANIC (MECHANIC_ID,SVC_ID) ON DELETE CASCADE, CONSTRAINT FK_receiver_mid FOREIGN KEY (receiver_mid,SVC_ID) REFERENCES MECHANIC (MECHANIC_ID,SVC_ID) ON DELETE CASCADE, CONSTRAINT FK_SVC_ID FOREIGN KEY (SVC_ID) REFERENCES SERVICE_CENTER (SVC_ID) ON DELETE CASCADE )
